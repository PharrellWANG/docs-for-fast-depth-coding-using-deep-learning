

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Edge Strength Analysis &mdash; Fast Depth Coding Using Deep Learning 0.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Fast Depth Coding Using Deep Learning 0.1.0 documentation" href="index.html"/>
        <link rel="next" title="Deep Learning" href="training.html"/>
        <link rel="prev" title="Data Visualization" href="data-visu.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Fast Depth Coding Using Deep Learning
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Propose the Algorithm</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="proposed-algorithm.html">Proposed Algorithm</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre-process the Data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data-collection.html">Data Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-statistics.html">Processing Steps and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-visu.html">Data Visualization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Edge Strength Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#motivation-originated-from-experience">Motivation originated from experience</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#confusion-matrix-obtained-during-training-process">Confusion matrix obtained during training process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#statistics">Statistics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#algorithm-designed-for-edge-analysis">Algorithm designed for edge analysis</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Train the Model</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="training.html">Deep Learning</a></li>
</ul>
<p class="caption"><span class="caption-text">Evaluate the Model</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="eval-model-08.html">Model trained from size 08x08</a></li>
<li class="toctree-l1"><a class="reference internal" href="eval-model-16.html">Model trained from size 16x16</a></li>
</ul>
<p class="caption"><span class="caption-text">Use the Learned Model</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tf-speed.html">Time Cost of TF in C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Encoder Integration in C++</a></li>
</ul>
<p class="caption"><span class="caption-text">Simulation Results</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="simu-results.html">Simulation Results</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>
<p class="caption"><span class="caption-text">Quick Memo</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quick-memo.html">Quick Memo</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Fast Depth Coding Using Deep Learning</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Edge Strength Analysis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/edge-strength-analysis.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="edge-strength-analysis">
<span id="id1"></span><h1>Edge Strength Analysis<a class="headerlink" href="#edge-strength-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="motivation-originated-from-experience">
<h2>Motivation originated from experience<a class="headerlink" href="#motivation-originated-from-experience" title="Permalink to this headline">¶</a></h2>
<p>To know the motivation, first you have to know some experience.</p>
<p>I have tried to train the data by using 37 classes,
including mode [0, 1, 2, …, 34, DMM1, DMM4]. (2 + 33 + 2 = 37)</p>
<div class="section" id="confusion-matrix-obtained-during-training-process">
<h3>Confusion matrix obtained during training process<a class="headerlink" href="#confusion-matrix-obtained-during-training-process" title="Permalink to this headline">¶</a></h3>
<p>Confusion matrix provided for downloading.</p>
<p><a class="reference download internal" href="_downloads/ckpt-10342.csv" download=""><code class="xref download docutils literal"><span class="pre">Confusion</span> <span class="pre">matrix</span> <span class="pre">after</span> <span class="pre">10342</span> <span class="pre">steps</span></code></a></p>
<p><a class="reference download internal" href="_downloads/ckpt-20622.csv" download=""><code class="xref download docutils literal"><span class="pre">Confusion</span> <span class="pre">matrix</span> <span class="pre">after</span> <span class="pre">20622</span> <span class="pre">steps</span></code></a></p>
<p><a class="reference download internal" href="_downloads/ckpt-30757.csv" download=""><code class="xref download docutils literal"><span class="pre">Confusion</span> <span class="pre">matrix</span> <span class="pre">after</span> <span class="pre">30757</span> <span class="pre">steps</span></code></a></p>
<p><a class="reference download internal" href="_downloads/ckpt-40884.csv" download=""><code class="xref download docutils literal"><span class="pre">Confusion</span> <span class="pre">matrix</span> <span class="pre">after</span> <span class="pre">40884</span> <span class="pre">steps</span></code></a></p>
<p><a class="reference download internal" href="_downloads/ckpt-51009.csv" download=""><code class="xref download docutils literal"><span class="pre">Confusion</span> <span class="pre">matrix</span> <span class="pre">after</span> <span class="pre">51009</span> <span class="pre">steps</span></code></a></p>
<p><a class="reference download internal" href="_downloads/ckpt-61168.csv" download=""><code class="xref download docutils literal"><span class="pre">Confusion</span> <span class="pre">matrix</span> <span class="pre">after</span> <span class="pre">61168</span> <span class="pre">steps</span></code></a></p>
</div>
<div class="section" id="statistics">
<h3>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>total train samples: 2900*37</li>
<li>Batch size:128</li>
<li>61168*128/2900/37 = 73 epoch</li>
</ol>
<ul class="simple">
<li>Refer to the <strong>confusing matrix</strong>, after 73 epochs, the model still don’t understand the features of
mode 0, 1, 35, 36, which possibly means the CNN is not capable of
learning features for 0, 1, 35, 36.
Or it can mean my network size is
not large enough to learn the features inside mode 0, 1, 35, 36.
Or it can mean CNN is not enough for learn them.
I think RNN is able to gain much lifting in classification accuracy by taking
the information related to time into consideration. But due to the limited time,
i have not tried it yet.</li>
<li>Refer to the <strong>confusing matrix</strong>, the CNN must be able to distinguish between angular modes.</li>
</ul>
<p>After visualizing the angular modes, the blocks with very weak edges
for each mode are frequently observed. They looks like the planar or DC mode.</p>
<p>I’ve tried to train the model while the blocks with weak edges are kept in
the training data. Results are not good.</p>
<p>Then it is natural to come to the conclusion that it is not good to mix smooth block with
angular blocks for classification under the confidence that our neural net is
good in the sense of both architecture and hyper params. (The confidence
originated from the high accuracy on CIFAR-10/100 data set, and the conclusion
in the paper of <strong>wide residul network</strong> are verified clearly.)</p>
<p>The conclusion <code class="docutils literal"><span class="pre">smooth</span> <span class="pre">regions</span> <span class="pre">will</span> <span class="pre">trap</span> <span class="pre">CNN</span> <span class="pre">in</span> <span class="pre">ill</span> <span class="pre">condition</span></code> is also
found in the journal paper below:</p>
<p><a class="reference download internal" href="_downloads/[Journal]CU Partition Mode Decision for HEVC Hardwired Intra Encoder Using CNN.pdf" download=""><code class="xref download docutils literal"><span class="pre">CU</span> <span class="pre">Partition</span> <span class="pre">Mode</span> <span class="pre">Decision</span> <span class="pre">for</span> <span class="pre">HEVC</span> <span class="pre">Hardwired</span> <span class="pre">Intra</span> <span class="pre">Encoder</span> <span class="pre">Using</span> <span class="pre">CNN</span></code></a></p>
<p>So we decided to remove the smooth regions.</p>
<p>When trying to remove the smooth region, we are facing a question:</p>
<p><code class="docutils literal"><span class="pre">How</span> <span class="pre">to</span> <span class="pre">define</span> <span class="pre">the</span> <span class="pre">smooth</span> <span class="pre">regions?</span></code></p>
<p>Well, see below for the answer.</p>
</div>
</div>
<div class="section" id="algorithm-designed-for-edge-analysis">
<h2>Algorithm designed for edge analysis<a class="headerlink" href="#algorithm-designed-for-edge-analysis" title="Permalink to this headline">¶</a></h2>
<p>For answering the question of <code class="docutils literal"><span class="pre">How</span> <span class="pre">to</span> <span class="pre">define</span> <span class="pre">the</span> <span class="pre">smooth</span> <span class="pre">regions</span></code>,
we can think like this: can we define the sharpness of the edges?</p>
<p>Yes. We can.</p>
<p>See below code snippets for a quick understanding of how we define
the edge strength:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">each</span> <span class="n">sample</span> <span class="p">(</span><span class="n">a</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">collected</span> <span class="n">data</span> <span class="nb">set</span> <span class="p">(</span><span class="n">a</span> <span class="n">csv</span> <span class="nb">file</span><span class="p">):</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">the_pixel_data_of_a_square_block_as_a_matrix</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width_of_the_block</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width_of_the_block</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1">#calculating the hor and ver strength</span>
                <span class="n">horizontal_strength</span> <span class="o">=</span> \
                    <span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="n">features</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">features</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">vertical_strength</span> <span class="o">=</span> \
                    <span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">features</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">features</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="c1"># calculating the power</span>
                <span class="n">strength</span> <span class="o">=</span> <span class="n">horizontal_strength</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">vertical_strength</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="c1"># put each strength into an numpy array to get the</span>
                <span class="c1"># total strength of a block (or you can say a line</span>
                <span class="c1"># in the csv file)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">strength</span><span class="p">]))</span>
                <span class="n">total_strength</span> <span class="o">+=</span> <span class="n">strength</span>

        <span class="k">assert</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Then calculate top (width*2 &amp;&amp; non-zero) average.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># calculating top (width*2 &amp;&amp; non-zero) average.</span>
<span class="c1"># step1: top width*2 values in the numpy arrary</span>
<span class="n">top_k</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">data</span><span class="p">)][</span><span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">RESHAPE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:]</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">top_k</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># step2: non-zero values (because sometimes the edge length can be</span>
<span class="c1"># short. We only want the sharpness. We do not want smooth regions</span>
<span class="c1"># to affect the sharpness.)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">top_k</span><span class="p">[</span><span class="n">top_k</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()]</span>
<span class="c1"># e.g., [[2, 0], [0, 0]], i exclude it from the concept of sharp</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">)]</span>
<span class="c1"># all the strength are zero. (that is to say , it is like DC mode)</span>
<span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ave</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ave</span><span class="p">])</span>

<span class="c1"># add ave of the blocks grouping by each mode.</span>
<span class="c1"># calculate the ave by dividing the number of blocks of each mode</span>
</pre></div>
</div>
<p>We encouraging the readers to check the python codes provided below for
downloading to understand the algorithm used by us. (The python codes for
the algorithm is short and easy to understand!)</p>
<p>Edge analysis algorithm implemented in python is provided for downloading.</p>
<p><a class="reference download internal" href="_downloads/edge_strength_analysis.py" download=""><code class="xref download docutils literal"><span class="pre">Edge</span> <span class="pre">Analysis</span> <span class="pre">in</span> <span class="pre">Python</span></code></a></p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="training.html" class="btn btn-neutral float-right" title="Deep Learning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="data-visu.html" class="btn btn-neutral" title="Data Visualization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Pharrell.zx WANG.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>